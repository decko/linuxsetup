#!/usr/bin/env bash

# better ls
ls() {
    if [ "$#" = 0 ]; then
        /bin/ls --block-size=M --color -l
    else
        /bin/ls "$@"
    fi
}

# Emacs aliasing
function em { emacsclient -a '' -c -n $1; }
function et { emacsclient -a '' -t $1; }

function edk { emacsclient -e "(kill-emacs)"; }
function ekr { edk && em && exit; }

# Project switching
function 8pc { cd ~/code/$1; }
function 8pl { cd ~/locaweb/$1; }

# Bundle exec aliasing
function 8bes { bundle exec rspec; }
function 8be { bundle exec $*; }
function 8bejs { bundle exec jekyll serve --watch --drafts; }

# Rake db migrates
function 8rdbm {
    echo "Migrating $RAILS_ENV..."
    bundle exec rake db:migrate
    echo "---"
    echo "Rollbacking $RAILS_ENV..."
    bundle exec rake db:migrate VERSION=0
    echo "---"
    echo "Migrating $RAILS_ENV..."
    bundle exec rake db:migrate
    echo "---"
    echo "Finished"
}
function 8frdbm { 8rdbm; RAILS_ENV=test 8rdbm; }

function 8rdbr {
    echo "Reseting $RAILS_ENV..."
    bundle exec rake db:drop db:create db:migrate
}
function 8frdbr { 8rdbr; RAILS_ENV=test 8rdbr; }

function dfgb { df -BG; }

function 8txc { xclip -i -selection clipboard; }

function 8inf {
    until [[ $? != 0 ]]; do eval "$*"; done
    zenity --info --text="Finished the infinite loop of $1"
}

function 8gr { cd $(git rev-parse --show-toplevel); }

function 8changelog {
    ref=$1
    [ -z "$ref" ] && ref=$(git describe --tags --abbrev=0)
    git log --no-merges --oneline "$ref"..HEAD
}
function 8mkch { 8changelog $1 | 8txc ;}

function bry {
    read -ep "(B)ry err:${?}> "

    if [ "$REPLY" != exit ]; then
        echo $(eval "$REPLY") >$(tty)
        bry $@
    fi
}
export -f bry

gitmulticast() { $CODE_DIR/linuxsetup/scripts/gitmulticast.sh $@ ;}
8plp() { CODE_DIR=$HOME/locaweb $CODE_DIR/linuxsetup/scripts/gitmulticast.sh pull ;}
8pcp() { gitmulticast pull ;}
